# Copyright (c) {% if start_year is defined and start_year != year %}{{ start_year }} - {% endif %}{{ year }} Big Ladder Software, LLC.
# See the LICENSE.txt file for additional terms and conditions.
# NOTE: THIS FILE IS AUTO-GENERATED. DO NOT EDIT.
cmake_minimum_required(VERSION 3.10) # required for gtest_discover_tests

project({{ project_name | lower }}
{%- if use_cmake_version %}
    VERSION {{ version_major }}.{{ version_minor }}.{{ version_patch }}
{%- endif %}
{%- if project_short_description is defined %}
    DESCRIPTION "{{ project_short_description }}"
{%- endif %}
    LANGUAGES CXX
)

# NOTE: Required for some dependencies to build (e.g., toml11).
set(CMAKE_CXX_STANDARD {{ cpp_std }})
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin")

if (NOT REQUESTED_CPP_COMPLIER_VERSION VERSION_EQUAL CMAKE_CXX_COMPILER_VERSION)
    if (STRICT_VERSION)
        message(FATAL_ERROR "\nRequested compiler ${REQUESTED_CPP_COMPLIER_VERSION} is not available. "
        "Please install it using the Visual Studio Installer, or select an available toolset compiler "
        "in the toolchain file."
        )
    else()
        message(WARNING "\nBuild will use compiler version ${CMAKE_CXX_COMPILER_VERSION} even though ${REQUESTED_CPP_COMPLIER_VERSION} was requested.")
    endif()
endif()

# Set a default build type if none was specified
if (NOT CMAKE_BUILD_TYPE AND NOT CMAKE_CONFIGURATION_TYPES)
    message(STATUS "Setting build type to 'Release' as none was specified.")
    set(CMAKE_BUILD_TYPE Release CACHE STRING "Choose the type of build." FORCE)
    # Set the possible values of build type for cmake-gui
    set_property(CACHE CMAKE_BUILD_TYPE PROPERTY STRINGS "Debug" "Release"
            "MinSizeRel" "RelWithDebInfo")
endif ()

set(CMAKE_MODULE_PATH "${PROJECT_SOURCE_DIR}/cmake")

include(CMakeDependentOption)

cmake_dependent_option(${PROJECT_NAME}_BUILD_TESTING "Build ${PROJECT_NAME} testing targets" ON "${PROJECT_NAME}_IS_TOP_LEVEL" OFF)
option(${PROJECT_NAME}_COVERAGE "Add ${PROJECT_NAME} coverage reports" OFF)
#cmake_dependent_option(${PROJECT_NAME}_BUILD_EXAMPLES "Build ${PROJECT_NAME} examples" ON "${PROJECT_NAME}_IS_TOP_LEVEL" OFF)
cmake_dependent_option(${PROJECT_NAME}_WARNINGS_AS_ERRORS "Treat warnings in ${PROJECT_NAME} as errors" ON "${PROJECT_NAME}_IS_TOP_LEVEL" OFF)
option(${PROJECT_NAME}_STATIC_LIB "Make ${PROJECT_NAME} a static library" ON)

if (NOT ${PROJECT_NAME}_STATIC_LIB)
    set(CMAKE_POSITION_INDEPENDENT_CODE ON)
endif ()

include(build-options-interface)

{%- if not use_cmake_version %}
# Automatic generation of version info
include(git-versioning)
process_git_version()
make_version_header()
message(STATUS "Building ${PROJECT_NAME} ${${PROJECT_NAME}_version}")
{%- else %}
include(get-git-hash)
message(STATUS "Building ${PROJECT_NAME} ${PROJECT_VERSION} (${PROJECT_GIT_HASH})")
{%- endif %}
{#- NOTE: configuration has to happen after git hash determined #}
{%- for config in headers_config %}
configure_file(
    ${PROJECT_SOURCE_DIR}/include/{{ config.code_path }}
    ${PROJECT_BINARY_DIR}/include/{{ config.code_path|replace(".in", "") }}
)
{%- endfor %}


# Set up testing/coverage
if (${PROJECT_NAME}_BUILD_TESTING)
    enable_testing()
    if (${PROJECT_NAME}_COVERAGE)
        set(ENABLE_COVERAGE ON CACHE BOOL "" FORCE)
        find_package(codecov)
    endif ()
endif ()

# Add subdirectories
add_subdirectory(vendor)
add_subdirectory(src)
{% if use_app -%}
add_subdirectory(app)
{%- endif %}

#if (${PROJECT_NAME}_BUILD_EXAMPLES)
#    add_subdirectory(examples)
#endif ()

if (${PROJECT_NAME}_BUILD_TESTING)
    add_subdirectory(test)
    if (${PROJECT_NAME}_COVERAGE)
        coverage_evaluate()
    endif ()
endif ()
