FROM silkeh/clang:{{ clang_format_version }}

RUN mkdir /app

WORKDIR /app

SHELL ["/bin/sh", "-c"]
CMD find src/ -iname '*.h' -o -iname '*.cpp' | xargs clang-format -i --style=file && \
  find include/ -iname '*.h' -o -iname '*.cpp' | xargs clang-format -i --style=file && \
  find test/ -iname '*.h' -o -iname '*.cpp' | xargs clang-format -i --style=file{%- if use_app %} && \
  find app/ -iname '*.h' -o -iname '*.cpp' | xargs clang-format -i --style=file{%- endif %}

